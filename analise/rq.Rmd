---
title: "questões de pesquisa"
output:
  html_notebook:
    code_folding: hide
    fig_height: 4
    fig_width: 5
    theme: readable
    toc: yes
    toc_float: yes
  html_document:
    df_print: paged
    toc: yes
editor_options: chunk_outp
---

```{r message=FALSE, warning=FALSE}
options(warn=-1) # ignore warns
require(GGally, quietly = TRUE)
require(reshape2, quietly = TRUE)
require(tidyverse, quietly = TRUE, warn.conflicts = FALSE)
library(ggfortify)
library(cluster)
library(broom)
library(tidyverse)
library(plotly)
library(resample)
library(highcharter)
library(lubridate)
library(ggpubr)
library(here)
```

Carregando dados
```{r message=FALSE, warning=FALSE}
carta_capital <- read_csv(here::here("data/carta_capital.csv")) %>% filter(arg >= 0, sen >= 0, val >= 0, pre >= 0, mod >= 0)
estadao <- read_csv(here::here("data/estadao.csv")) %>% filter(arg >= 0, sen >= 0, val >= 0, pre >= 0, mod >= 0)
folha <- read_csv(here::here("data/folha.csv")) %>% filter(arg >= 0, sen >= 0, val >= 0, pre >= 0, mod >= 0)
oantagonista <- read_csv(here::here("data/oantagonista.csv")) %>% filter(arg >= 0, sen >= 0, val >= 0, pre >= 0, mod >= 0)
oglobo <- read_csv(here::here("data/oglobo.csv")) %>% filter(arg >= 0, sen >= 0, val >= 0, pre >= 0, mod >= 0)
veja <- read_csv(here::here("data/veja.csv")) %>% filter(arg >= 0, sen >= 0, val >= 0, pre >= 0, mod >= 0)

news <-bind_rows(
    "carta_capital" = carta_capital,
    "estadao" = estadao, 
    "folha" = folha, 
    "oantagonista" = oantagonista,
    "oglobo" = oglobo,
    "veja" = veja,
    .id = "jornal")
``` 

1- Qual o jornal com maior legibilidade?

```{r message=FALSE, warning=FALSE}
readabilityMetrics <- read_csv(here::here("data/readability_metrics.csv"))
readabilityMetrics <- merge(x = readabilityMetrics, y = news, all = TRUE)
```

2- Existe relação entre tamanho do texto/legibilidade e popularidade(comentários)?

```{r}

```

3- Como é a distribuição das dimensões de subjetividade ao longo do ano?

```{r}
bias_month <- news %>%
  mutate(month = month(as_datetime(date))) %>%
  group_by(month) %>%
  summarise(
    arg = mean(arg),
    sen = mean(sen),
    val = mean(val),
    pre = mean(pre),
    mod = mean(mod)
  )

highchart() %>% 
  hc_title(text = "Distribuição das dimensões de subjetividade ao longo do ano") %>%
  hc_xAxis(categories = c("jan", "fev", "mar", "abr", "mai", "jun", "jul", "ago", "set", "out", "nov", "dez")) %>% 
  hc_yAxis(title = list(text = "subjetividade")) %>% 
  hc_tooltip(pointFormat = "{point.y}%") %>% 
  hc_add_series(name = "arg" , data = (bias_month$arg)) %>% 
  hc_add_series(name = "sen" , data = (bias_month$sen)) %>% 
  hc_add_series(name = "val" , data = (bias_month$val)) %>% 
  hc_add_series(name = "pre" , data = (bias_month$pre)) %>% 
  hc_add_series(name = "mod" , data = (bias_month$mod))
```

4- Qual o jornal mais subjetivo (considerando todas as notícias em um ano de coleta)?

```{r}

```

5- Existe relação entre subjetividade de legibilidade do texto em uma notícia?

```{r}

```

6- Existe relação entre subjetividade e tamanho do texto em uma notícia?

```{r}
biasNews <- news %>% 
  mutate(bias_news = (1 - (arg + sen + val + pre + mod) / 5) * 100) %>% 
  select(url, bias_news)

metaData <- read_csv(here::here("data/meta_data.csv")) %>% 
  filter(text_size <= 1000 & number_comments <= 1000) # remove outliers

bias_pop <- merge(x = biasNews, y = metaData, all = TRUE) %>% 
            filter(!is.na(text_size), !is.na(number_comments), !is.na(bias_news))

bias_pop %>% 
  summarise(pearson = cor(bias_news, number_comments, method = "pearson"), 
            spearman = cor(bias_news, number_comments, method = "spearman"), 
            kendall = cor(bias_news, number_comments, method = "kendall")
            )
```

```{r}
theta_c = cor(bias_pop$bias_news, bias_pop$number_comments)

repeticoes = 5000 # pelo menos 2000, mas mais não faz mal.
um_bootstrap <- function(x){
  bias_news = x %>% pull(bias_news)
  bias_news <- sample(bias_news,           # amostre dos dados
                   size = NROW(bias_news), # tamanho igual ao recebido
                   replace = TRUE)         # aqui é o bootstrap
  number_comments = x %>% pull(number_comments)
  number_comments <- sample(number_comments,           # amostre dos dados
                   size = NROW(number_comments),       # tamanho igual ao recebido
                   replace = TRUE)                     # aqui é o bootstrap
  return(cor(bias_news, number_comments))
}

# A REAMOSTRAGEM
reamostragens = tibble(i = 1:repeticoes) %>% 
  mutate(theta_c_s = map_dbl(i, ~ um_bootstrap(bias_pop)))

reamostragens = reamostragens %>% 
  mutate(conf.low = theta_c + quantile((theta_c_s - theta_c), .05), 
         conf.high = theta_c + quantile((theta_c_s - theta_c), .95), 
         statistic = theta_c) 

reamostragens %>%
    ggplot(aes(
        x = "",
        y = statistic,
        ymin = conf.low,
        ymax = conf.high,
    )) + 
    geom_errorbar(width = .2) +
  labs(x = "")
```


