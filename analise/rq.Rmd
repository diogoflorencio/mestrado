---
title: "questões de pesquisa"
output:
  html_notebook:
    code_folding: hide
    fig_height: 4
    fig_width: 5
    theme: readable
    toc: yes
    toc_float: yes
  html_document:
    df_print: paged
    toc: yes
editor_options: chunk_outp
---

```{r message=FALSE, warning=FALSE}
options(warn=-1) # ignore warns
require(GGally, quietly = TRUE)
require(reshape2, quietly = TRUE)
require(tidyverse, quietly = TRUE, warn.conflicts = FALSE)
library(ggfortify)
library(cluster)
library(broom)
library(tidyverse)
library(plotly)
library(resample)
library(highcharter)
library(lubridate)
library(ggpubr)
library(here)
```

Carregando dados
```{r message=FALSE, warning=FALSE}
carta_capital <- read_csv(here::here("data/carta_capital.csv")) %>% filter(arg >= 0, sen >= 0, val >= 0, pre >= 0, mod >= 0)
estadao <- read_csv(here::here("data/estadao.csv")) %>% filter(arg >= 0, sen >= 0, val >= 0, pre >= 0, mod >= 0)
folha <- read_csv(here::here("data/folha.csv")) %>% filter(arg >= 0, sen >= 0, val >= 0, pre >= 0, mod >= 0)
oantagonista <- read_csv(here::here("data/oantagonista.csv")) %>% filter(arg >= 0, sen >= 0, val >= 0, pre >= 0, mod >= 0)
oglobo <- read_csv(here::here("data/oglobo.csv")) %>% filter(arg >= 0, sen >= 0, val >= 0, pre >= 0, mod >= 0)
veja <- read_csv(here::here("data/veja.csv")) %>% filter(arg >= 0, sen >= 0, val >= 0, pre >= 0, mod >= 0)

news <-bind_rows(
    "carta_capital" = carta_capital,
    "estadao" = estadao, 
    "folha" = folha, 
    "oantagonista" = oantagonista,
    "oglobo" = oglobo,
    "veja" = veja,
    .id = "jornal")
``` 

1- Qual o jornal com maior legibilidade?

```{r message=FALSE, warning=FALSE}
readabilityMetrics <- read_csv(here::here("data/readability_metrics.csv"))
readabilityMetrics <- merge(x = readabilityMetrics, y = news, all = TRUE) %>% filter(!is.na(jornal))
readabilityMetrics <- readabilityMetrics %>% 
  group_by(jornal) %>% 
  summarise(coleman_liau = mean(coleman_liau_index),
            smog_ = mean(smog_index),
            lix = mean(lix_index),
            dale_chall = mean(dale_chall_score))
readabilityMetrics
```

2- Existe relação entre tamanho do texto/legibilidade e popularidade(comentários)?

```{r}
metaData <- read_csv(here::here("data/meta_data.csv")) %>% 
  filter(text_size <= 1000 & number_comments <= 1000) # remove outliers

pearson_ic <- metaData %>% 
  bootstrap(cor(text_size, number_comments, method = "pearson"), 
            R = 2000) %>% 
    CI.percentile(probs = c(.025, .975))

spearman_ic <- metaData %>% 
  bootstrap(cor(text_size, number_comments, method = "spearman"), 
            R = 2000) %>% 
    CI.percentile(probs = c(.025, .975))

kendall_ic <- metaData %>% 
  bootstrap(cor(text_size, number_comments, method = "kendall"), 
            R = 2000) %>% 
    CI.percentile(probs = c(.025, .975))

len_pop = data.frame(rbind(pearson_ic, spearman_ic, kendall_ic))

len_pop$coef = c("pearson", "spearman", "kendall")

len_pop %>% 
  ggplot(aes(x = coef, ymin = X2.5., ymax = X97.5.)) + 
  geom_errorbar(width = .2) +
  labs(x = "", y = "percentual de subjetividade")

```

3- Como é a distribuição das dimensões de subjetividade ao longo do ano?

```{r}
bias_month <- news %>%
  mutate(month = month(as_datetime(date))) %>%
  group_by(month) %>%
  summarise(
    arg = mean(arg),
    sen = mean(sen),
    val = mean(val),
    pre = mean(pre),
    mod = mean(mod)
  )

highchart() %>% 
  hc_title(text = "Distribuição das dimensões de subjetividade ao longo do ano") %>%
  hc_xAxis(categories = c("jan", "fev", "mar", "abr", "mai", "jun", "jul", "ago", "set", "out", "nov", "dez")) %>% 
  hc_yAxis(title = list(text = "subjetividade")) %>% 
  hc_tooltip(pointFormat = "{point.y}%") %>% 
  hc_add_series(name = "arg" , data = (bias_month$arg)) %>% 
  hc_add_series(name = "sen" , data = (bias_month$sen)) %>% 
  hc_add_series(name = "val" , data = (bias_month$val)) %>% 
  hc_add_series(name = "pre" , data = (bias_month$pre)) %>% 
  hc_add_series(name = "mod" , data = (bias_month$mod))
```

4- Qual o jornal mais subjetivo (considerando todas as notícias em um ano de coleta)?

```{r}
biasNews <- news %>% 
  mutate(bias_news = (1 - (arg + sen + val + pre + mod) / 5) * 100) %>% 
  select(jornal, url, bias_news)

subj_estadao <- biasNews %>% 
  filter(jornal == "estadao") %>% 
  bootstrap(median(bias_news), 
            R = 2000) %>% 
    CI.percentile(probs = c(.025, .975))


subj_folha <- biasNews %>% 
  filter(jornal == "folha") %>% 
  bootstrap(median(bias_news), 
            R = 2000) %>% 
    CI.percentile(probs = c(.025, .975))

subj_oantagonista <- biasNews %>% 
  filter(jornal == "oantagonista") %>% 
  bootstrap(median(bias_news), 
            R = 2000) %>% 
    CI.percentile(probs = c(.025, .975))

subj_veja <- biasNews %>% 
  group_by(jornal == "veja") %>% 
  bootstrap(median(bias_news), 
            R = 2000) %>% 
    CI.percentile(probs = c(.025, .975))

subj_ci = data.frame(rbind(subj_estadao, subj_folha, subj_oantagonista, subj_veja))

subj_ci$jornal = c("estadao", "folha", "oantagonista", "veja")

subj_ci %>% 
  ggplot(aes(x = jornal, ymin = X2.5., ymax = X97.5., color = jornal)) + 
  geom_errorbar(width = .2) +
  labs(x = "", y = "percentual de subjetividade")

```

5- Existe relação entre subjetividade de legibilidade do texto em uma notícia?

```{r}
readabilityMetrics <- read_csv(here::here("data/readability_metrics.csv"))
readabilityMetrics <- merge(x = readabilityMetrics, y = news, all = TRUE) %>% filter(!is.na(jornal))
readabilityMetrics <- readabilityMetrics %>% 
  mutate(bias_news = (1 - (arg + sen + val + pre + mod) / 5) * 100)

pearson_ic <- readabilityMetrics %>% 
  bootstrap(cor(bias_news, coleman_liau_index, method = "pearson"), 
            R = 2000) %>% 
    CI.percentile(probs = c(.025, .975))

spearman_ic <- readabilityMetrics %>% 
  bootstrap(cor(bias_news, coleman_liau_index, method = "spearman"), 
            R = 2000) %>% 
    CI.percentile(probs = c(.025, .975))

kendall_ic <- readabilityMetrics %>% 
  bootstrap(cor(bias_news, coleman_liau_index, method = "kendall"), 
            R = 2000) %>% 
    CI.percentile(probs = c(.025, .975))

cor_coleman = data.frame(rbind(pearson_ic, spearman_ic, kendall_ic))

cor_coleman$coef = c("pearson", "spearman", "kendall")

pearson_ic <- readabilityMetrics %>% 
  bootstrap(cor(bias_news, smog_index, method = "pearson"), 
            R = 2000) %>% 
    CI.percentile(probs = c(.025, .975))

spearman_ic <- readabilityMetrics %>% 
  bootstrap(cor(bias_news, smog_index, method = "spearman"), 
            R = 2000) %>% 
    CI.percentile(probs = c(.025, .975))

kendall_ic <- readabilityMetrics %>% 
  bootstrap(cor(bias_news, smog_index, method = "kendall"), 
            R = 2000) %>% 
    CI.percentile(probs = c(.025, .975))

cor_smog = data.frame(rbind(pearson_ic, spearman_ic, kendall_ic))

cor_smog$coef = c("pearson", "spearman", "kendall")

pearson_ic <- readabilityMetrics %>% 
  bootstrap(cor(bias_news, lix_index, method = "pearson"), 
            R = 2000) %>% 
    CI.percentile(probs = c(.025, .975))

spearman_ic <- readabilityMetrics %>% 
  bootstrap(cor(bias_news, lix_index, method = "spearman"), 
            R = 2000) %>% 
    CI.percentile(probs = c(.025, .975))

kendall_ic <- readabilityMetrics %>% 
  bootstrap(cor(bias_news, lix_index, method = "kendall"), 
            R = 2000) %>% 
    CI.percentile(probs = c(.025, .975))

cor_lix = data.frame(rbind(pearson_ic, spearman_ic, kendall_ic))

cor_lix$coef = c("pearson", "spearman", "kendall")

pearson_ic <- readabilityMetrics %>% 
  bootstrap(cor(bias_news, dale_chall_score, method = "pearson"), 
            R = 2000) %>% 
    CI.percentile(probs = c(.025, .975))

spearman_ic <- readabilityMetrics %>% 
  bootstrap(cor(bias_news, dale_chall_score, method = "spearman"), 
            R = 2000) %>% 
    CI.percentile(probs = c(.025, .975))

kendall_ic <- readabilityMetrics %>% 
  bootstrap(cor(bias_news, dale_chall_score, method = "kendall"), 
            R = 2000) %>% 
    CI.percentile(probs = c(.025, .975))

cor_dale_chall = data.frame(rbind(pearson_ic, spearman_ic, kendall_ic))

cor_dale_chall$coef = c("pearson", "spearman", "kendall")

read_ci <-bind_rows(
    "cor_coleman" = cor_coleman,
    "cor_smog" = cor_smog, 
    "cor_lix" = cor_lix, 
    "cor_dale_chall" = cor_dale_chall,
    .id = "readability_metric")

```

6- Existe relação entre subjetividade e tamanho do texto em uma notícia?

```{r}
metaData <- read_csv(here::here("data/meta_data.csv")) %>% 
  filter(text_size <= 1000 & number_comments <= 1000) # remove outliers

bias_pop <- merge(x = biasNews, y = metaData, all = TRUE) %>% 
            filter(!is.na(text_size), !is.na(number_comments), !is.na(bias_news))

pearson_ic <- bias_pop %>% 
  bootstrap(cor(bias_news, number_comments, method = "pearson"), 
            R = 2000) %>% 
    CI.percentile(probs = c(.025, .975))

spearman_ic <- bias_pop %>% 
  bootstrap(cor(bias_news, number_comments, method = "spearman"), 
            R = 2000) %>% 
    CI.percentile(probs = c(.025, .975))

kendall_ic <- bias_pop %>% 
  bootstrap(cor(bias_news, number_comments, method = "kendall"), 
            R = 2000) %>% 
    CI.percentile(probs = c(.025, .975))

subj_len = data.frame(rbind(pearson_ic, spearman_ic, kendall_ic))

subj_len$coef = c("pearson", "spearman", "kendall")

subj_len %>% 
  ggplot(aes(x = coef, ymin = X2.5., ymax = X97.5.)) + 
  geom_errorbar(width = .2) +
  labs(x = "", y = "percentual de subjetividade")
```
